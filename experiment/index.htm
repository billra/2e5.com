<!DOCTYPE html>
<html>
<HEAD>
<TITLE>SVG interaction</TITLE>
<meta charset="utf-8">
<meta name="author" content="Bill Ola Rasmussen"> 
</HEAD>
<body>

<p>experiment</p>

<p>stage 1: click and drag balls</p>

<script type="text/javascript">

function WireSvgToEdit(svgid, htmXid, htmYid) {
	// lookups called only once
	var svgobj=document.getElementById(svgid);
	var htmXobj=document.getElementById(htmXid);
	var htmYobj=document.getElementById(htmYid);
	var nameField=document.getElementById('theName');

	// wire edit to svg
	WireEditChange(htmXobj,svgobj,'cx');
	WireEditChange(htmYobj,svgobj,'cy');

	// track old positions
	var oldX; // strategy: track mouse move offset, add to object position
	var oldY;
	var oldColor;

	// mouse down on actual svg object
	svgobj.onmousedown=function(evt){
		evt.preventDefault(); // disable browser drag and drop
		oldX=evt.clientX;
		oldY=evt.clientY;
		oldColor=svgobj.getAttribute('fill');
		svgobj.setAttribute('fill','green');
		// update html
		nameField.innerHTML=svgid;
		// move tracked from svg container so we don't get a premature onmouseleave
		svgContainer.onmousemove=function(evt) {
			evt.preventDefault(); // disable browser drag and drop
			nowX=parseInt(svgobj.getAttribute('cx'))+evt.clientX-oldX;
			nowY=parseInt(svgobj.getAttribute('cy'))+evt.clientY-oldY;
			oldX=evt.clientX;
			oldY=evt.clientY;
			svgobj.setAttribute('cx',nowX);
			svgobj.setAttribute('cy',nowY);
			// update contents of edit boxes
			htmXobj.value=nowX;
			htmYobj.value=nowY;
		};
		// likewise, end move tracked from container
		var endmove=function(evt) {
			svgobj.setAttribute('fill',oldColor);
			// update html
			nameField.innerHTML='nothing';
			// unwire svg object events
			svgContainer.onmousemove=null;
			svgContainer.onmouseup=null;
			svgContainer.onmouseleave=null;
		};
		svgContainer.onmouseup=endmove;
		svgContainer.onmouseleave=endmove;
	};
}

function WireEditChange(htmobj,svgobj,svgattr) {
	// initial state: edit takes value of svg item
    htmobj.value=svgobj.getAttribute(svgattr);
	// function called for each change
	htmobj.onchange=function(){
		svgobj.setAttribute(svgattr,htmobj.value);
	};
}

window.onload=function() {
	WireSvgToEdit('yellowCircle','yellowCircleXposEdit','yellowCircleYposEdit');
	WireSvgToEdit('orangeCircle','orangeCircleXposEdit','orangeCircleYposEdit');
};
</script>

<span style="display:inline-block; width:400px; height:400px; border:1px dotted black; padding:1px 1px 1px 1px; overflow:auto; resize:both">
<svg id="svgContainer" style="display: block" width="100%" height="100%">
  <circle id="yellowCircle" style="cursor: move" cx="170" cy="200" r="20" stroke="blue" stroke-width="4" fill="yellow"/>
  <circle id="orangeCircle" style="cursor: move" cx="230" cy="200" r="20" stroke="blue" stroke-width="4" fill="darkorange"/>
</svg>
</span>

<p><span id="theName">nothing</span> being dragged</p>

<form>yellow position:
<input type="number" id="yellowCircleXposEdit">
<input type="number" id="yellowCircleYposEdit">
</form>

<form>orange position:
<input type="number" id="orangeCircleXposEdit">
<input type="number" id="orangeCircleYposEdit">
</form>

</body>
</html>