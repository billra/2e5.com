<!DOCTYPE html>
<html>
<HEAD>
<TITLE>SVG interaction</TITLE>
<meta charset="utf-8">
<meta name="author" content="Bill Ola Rasmussen"> 
</HEAD>
<body>

<p>experiment</p>

<p>stage 1: click and drag balls</p>

<script type="text/javascript">
var dragitem=null;
var oldX,oldY; // strategy: track mouse move offset, add to object position
var oldColor;

function mouseDown(evt){
	evt.preventDefault(); // disable Firefox drag handling
	dragitem=evt.target;
	oldX=evt.clientX;
	oldY=evt.clientY;
	oldColor=dragitem.getAttribute("fill");
	dragitem.setAttribute("fill","green");
	// update html
	name=dragitem.getAttribute('id');
	document.getElementById("theName").innerHTML = name;
}

function move(evt){
	if(!dragitem){return;}
	evt.preventDefault(); // disable Firefox drag handling
	nowX=parseInt(dragitem.getAttribute('cx'))+evt.clientX-oldX;
	nowY=parseInt(dragitem.getAttribute('cy'))+evt.clientY-oldY;
	oldX=evt.clientX;
	oldY=evt.clientY;
	dragitem.setAttribute("cx",nowX);
	dragitem.setAttribute("cy",nowY);
	// update html
	name=dragitem.getAttribute('id');
	// almost OOP, select html element based on svg element name
	document.getElementById(name+"Xpos").innerHTML = nowX;
	document.getElementById(name+"Ypos").innerHTML = nowY;
	// update contents of edit boxes
	document.getElementById(name+"Xpos"+"Edit").value = nowX;
	document.getElementById(name+"Ypos"+"Edit").value = nowY;
}

function endMove(evt){
	if(!dragitem){return;}
	dragitem.setAttribute("fill",oldColor);
	dragitem=null;
	// update html
	document.getElementById("theName").innerHTML = 'nothing';
}

function editChange(formInput){
	svgObjectId=formInput.id.substring(0,12); 
	elem=svgContainer.getElementById(svgObjectId);
	dimension=formInput.id.substring(12,13).toLowerCase(); // todo: OO approach, no rely on id
	attribute="c"+dimension;
	//console.log(attribute)
	elem.setAttribute(attribute,formInput.value);
}
</script>

<span style="display:inline-block; width:400px; height:400px; border:1px dotted black; padding:1px 1px 1px 1px; overflow:auto; resize:both">
<svg id="svgContainer" style="display: block" width="100%" height="100%" onmousemove="move(evt)" onmouseup="endMove(evt)" onmouseleave="endMove(evt)" >
  <circle id="yellowCircle" style="cursor: move" cx="170" cy="200" r="20" stroke="blue" stroke-width="4" fill="yellow" onmousedown="mouseDown(evt)" />
  <circle id="orangeCircle" style="cursor: move" cx="230" cy="200" r="20" stroke="blue" stroke-width="4" fill="darkorange" onmousedown="mouseDown(evt)" />
</svg>
</span>

<p><span id="theName">nothing</span> selected</p>
<p>yellow position: <span id="yellowCircleXpos">?</span>,<span id="yellowCircleYpos">?</span></p>
<p>orange position: <span id="orangeCircleXpos">?</span>,<span id="orangeCircleYpos">?</span></p>

<form>
<input type="number" id="yellowCircleXposEdit" onchange="editChange(this)">
<input type="number" id="yellowCircleYposEdit" onchange="editChange(this)">
</form>

<form>
<input type="number" id="orangeCircleXposEdit" onchange="editChange(this)">
<input type="number" id="orangeCircleYposEdit" onchange="editChange(this)">
</form>

</body>
</html>